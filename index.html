<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2C1810">
    <meta name="description" content="Interactive Rome travel map with custom pins and offline support">
    <title>Trip2Rome</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- Header -->
    <header id="header">
        <div class="header-left">
            <h1>Trip2Rome</h1>
        </div>
        <div class="header-right">
            <button id="btn-live-track" class="header-btn" title="Live Tracking" aria-pressed="false">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 2c0-3.31-2.69-6-6-6s-6 2.69-6 6c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.48-.81 2.75-2 3.45l1 1.74c1.79-1.04 3-2.97 3-5.19zM12 4C7.31 4 3.07 7.09 1 11.45l1.97.85C4.73 8.79 8.09 6 12 6s7.27 2.79 9.03 6.3l1.97-.85C21 7.09 16.69 4 12 4z"/></svg>
                <span class="tracking-badge"></span>
            </button>
            <button id="btn-my-location" class="header-btn" title="My Location">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
            </button>
            <button id="btn-fit-all" class="header-btn" title="Show All Pins">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"/></svg>
            </button>
            <button id="btn-route" class="header-btn" title="Show Route">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M21.71 11.29l-9-9a.996.996 0 00-1.41 0l-9 9a.996.996 0 000 1.41l9 9c.39.39 1.02.39 1.41 0l9-9a.996.996 0 000-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/></svg>
            </button>
            <button id="btn-download" class="header-btn" title="Download Offline Map">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
            </button>
            <button id="btn-list" class="header-btn" title="Location List">
                <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            </button>
        </div>
    </header>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Floating Action Button - Add Location -->
    <button id="fab-add" title="Add Location">
        <svg viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
    </button>

    <!-- Add Mode Banner -->
    <div id="add-mode-banner" class="hidden">
        <span>Tap the map to place a pin</span>
        <button id="btn-use-gps" class="banner-btn">Use GPS</button>
        <button id="btn-cancel-add" class="banner-btn cancel">Cancel</button>
    </div>

    <!-- Route Info Bar -->
    <div id="route-bar" class="hidden">
        <span id="route-info"></span>
        <button id="btn-route-gmaps" class="banner-btn">Open in Maps</button>
        <button id="btn-route-close" class="banner-btn cancel">Close</button>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="hidden"></div>

    <!-- Location Detail Bottom Sheet -->
    <div id="detail-sheet" class="bottom-sheet hidden">
        <div class="sheet-handle"></div>
        <div class="sheet-content">
            <div class="detail-header">
                <span id="detail-dot" class="category-dot"></span>
                <h2 id="detail-name"></h2>
            </div>
            <div class="detail-meta">
                <p id="detail-category"></p>
                <p id="detail-address"></p>
                <p id="detail-datetime"></p>
            </div>
            <p id="detail-notes" class="detail-notes"></p>
            <div class="sheet-actions">
                <button id="btn-navigate" class="action-btn primary">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M21.71 11.29l-9-9a.996.996 0 00-1.41 0l-9 9a.996.996 0 000 1.41l9 9c.39.39 1.02.39 1.41 0l9-9a.996.996 0 000-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"/></svg>
                    Navigate
                </button>
                <button id="btn-edit" class="action-btn">Edit</button>
                <button id="btn-delete" class="action-btn danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Location Bottom Sheet -->
    <div id="add-sheet" class="bottom-sheet hidden">
        <div class="sheet-handle"></div>
        <div class="sheet-content">
            <h2 id="add-sheet-title">Add Location</h2>
            <form id="location-form">
                <div class="form-group">
                    <label for="input-name">Name *</label>
                    <input type="text" id="input-name" required placeholder="e.g., Best Gelato Spot">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <div id="category-selector" class="category-grid"></div>
                </div>
                <div class="form-group">
                    <label for="input-address">Address</label>
                    <input type="text" id="input-address" placeholder="Street address (optional)">
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label for="input-date">Date</label>
                        <input type="date" id="input-date">
                    </div>
                    <div class="form-group half">
                        <label for="input-time">Time</label>
                        <input type="time" id="input-time">
                    </div>
                </div>
                <div class="form-group">
                    <label for="input-notes">Notes</label>
                    <textarea id="input-notes" rows="3" placeholder="Tips, links, reminders..."></textarea>
                </div>
                <input type="hidden" id="input-lat">
                <input type="hidden" id="input-lng">
                <input type="hidden" id="input-id">
                <div class="sheet-actions">
                    <button type="button" id="btn-cancel-form" class="action-btn">Cancel</button>
                    <button type="submit" id="btn-save" class="action-btn primary">Save Location</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Location List Bottom Sheet -->
    <div id="list-sheet" class="bottom-sheet hidden">
        <div class="sheet-handle"></div>
        <div class="sheet-content">
            <div class="list-header">
                <h2>Locations</h2>
                <div id="filter-chips" class="filter-chips"></div>
            </div>
            <div id="location-list" class="location-list"></div>
        </div>
    </div>

    <!-- Tracking Status (screen reader) -->
    <div id="tracking-status" class="sr-only" aria-live="polite"></div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Download Progress Modal -->
    <div id="download-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Downloading Offline Map</h3>
            <p id="download-status">Preparing...</p>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
            <p id="download-percent">0%</p>
            <button id="btn-cancel-download" class="action-btn">Cancel</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
